<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cont√Åbaco - Prot√≥tipo</title>
    <link rel="icon" href="logo aplicativo.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; background-color: white; max-width: 800px; margin: 0 auto; padding: 0; padding-bottom: 60px; }
        header { background-color: #002775; color: white; display: flex; align-items: center; padding: 15px; position: sticky; top: 0; }
        header img { width: 32px; height: 32px; margin-right: 12px; cursor: pointer; }
        header h1 { font-size: 22px; }
        .container { display: flex; flex-direction: column; align-items: center; justify-content: start; min-height: calc(90vh - 60px); padding: 25px; }
        #timer { font-size: 80px; color: #002775; margin: 40px 0; }
        select { width: 100%; padding: 12px; margin: 12px 0; font-size: 18px; border-radius: 5px; border: 1px solid #000; appearance: none; background: url('data:image/svg+xml;utf8,<svg fill="black" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center; background-color: white; background-size: 20px; }
        button { background-color: #002775; color: white; border: none; border-radius: 20px; padding: 12px 24px; font-size: 18px; cursor: pointer; margin-top: 25px; width: 250px; }
        button.active { background-color: red; }
        .pause-btn { background-color: #FFA500; color: white; border: none; border-radius: 5px; padding: 8px 15px; font-size: 14px; cursor: pointer; margin-bottom: -15px; width: 120px; align-self: center; position: relative; z-index: 1; }
        footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: #002775; width: 100%; max-width: 800px; margin: 0 auto; display: flex; justify-content: space-around; padding: 12px 0; z-index: 10; }
        .icon-container { position: relative; width: 50px; height: 50px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .icon-container img { width: 38px; height: 38px; position: relative; transition: transform 0.3s ease; z-index: 2; }
        .icon-container .circle { position: absolute; bottom: 5px; width: 42px; height: 42px; border-radius: 50%; background-color: #002775; opacity: 0; transform: translateY(10px); transition: opacity 0.3s ease, transform 0.3s ease; z-index: 1; }
        .icon-container.active img { transform: translateY(-5px); }
        .icon-container.active .circle { opacity: 1; transform: translateY(0); }
        .scan-screen { display: none; text-align: center; padding: 25px; width: 100%; }
        .scan-screen h2 { color: #002775; margin-bottom: 15px; font-size: 24px; }
        #editScanIcon { cursor: pointer; margin-left: 12px; font-size: 22px; transition: color 0.3s; }
        #editScanIcon:hover { color: #FFA500; }
        .demo-note { color: #666; font-size: 14px; margin-bottom: 18px; font-style: italic; line-height: 1.3; }
        .abacus-container { width: 100%; background-color: #f0f0f0; border-radius: 10px; padding: 18px; margin: 18px 0; min-height: 180px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .abacus-item { display: flex; justify-content: space-between; margin: 8px 0; font-size: 16px; width: 100%; }
        .abacus-title { font-weight: bold; color: #002775; }
        .abacus-value { font-weight: bold; }
        .generate-btn { background-color: #4CAF50; color: white; border: none; border-radius: 5px; padding: 14px 24px; font-size: 18px; cursor: pointer; margin: 12px 0; width: 85%; max-width: 300px; }
        .report-btn { background-color: #002775; color: white; border: none; border-radius: 5px; padding: 14px 24px; font-size: 18px; cursor: pointer; margin: 12px 0; width: 100%; }
        #results { width: 100%; margin-top: 15px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background-color: white; padding: 25px; border-radius: 10px; width: 85%; max-width: 400px; text-align: center; }
        .modal-buttons { display: flex; justify-content: space-around; margin-top: 25px; }
        .modal-btn { padding: 10px 18px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .confirm-btn { background-color: #002775; color: white; }
        .cancel-btn { background-color: #ccc; color: black; }
        .edit-scan-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .edit-scan-item label { font-size: 16px; color: #333; text-align: left; }
        .edit-scan-input { width: 80px; padding: 6px; font-size: 16px; text-align: right; border: 1px solid #ccc; border-radius: 4px; }
        .edit-scan-input::-webkit-outer-spin-button, .edit-scan-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .edit-scan-input[type=number] { -moz-appearance: textfield; appearance: textfield; }
        .scan-required-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center; }
        .scan-required-content { background-color: white; padding: 30px; border-radius: 10px; width: 85%; max-width: 450px; text-align: center; position: relative; }
        .scan-required-text { margin-bottom: 25px; font-size: 18px; line-height: 1.4; }
        .understand-btn { background-color: #002775; color: white; border: none; border-radius: 5px; padding: 12px 24px; font-size: 18px; cursor: pointer; margin-top: 18px; }
        .summary-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; }
        .summary-content { background-color: white; padding: 25px; border-radius: 10px; width: 85%; max-width: 450px; }
        .summary-title { color: #002775; text-align: center; margin-bottom: 18px; font-size: 22px; }
        .summary-item { margin-bottom: 12px; font-size: 16px; }
        .summary-label { font-weight: bold; color: #002775; }
        .summary-value { margin-left: 5px; }
        .summary-btn { background-color: #002775; color: white; border: none; border-radius: 5px; padding: 12px 24px; font-size: 18px; cursor: pointer; margin-top: 25px; width: 100%; }
        .report-screen { display: none; padding: 25px; width: 100%; }
        .report-screen h2 { color: #002775; margin-bottom: 18px; text-align: center; font-size: 24px; }
        .report-item { background-color: #f0f0f0; border-radius: 8px; padding: 18px; margin-bottom: 12px; cursor: pointer; }
        .report-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: bold; color: #002775; font-size: 16px; }
        .report-date { font-size: 14px; color: #666; }
        .report-funcionarios { font-size: 16px; margin-top: 8px; }
        .no-reports { text-align: center; color: #666; margin-top: 40px; font-style: italic; font-size: 16px; }
        .report-detail-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center; }
        .report-detail-content { background-color: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .report-detail-title { color: #002775; text-align: center; margin-bottom: 18px; font-size: 22px; }
        .report-detail-info { margin-bottom: 18px; }
        .report-detail-item { display: flex; justify-content: space-between; margin: 10px 0; font-size: 16px; }
        .report-detail-total { font-weight: bold; margin-top: 12px; padding-top: 12px; border-top: 1px solid #ddd; font-size: 16px; }
        .chart-container { width: 100%; margin: 25px 0; }
        .close-report-btn { background-color: #002775; color: white; border: none; border-radius: 5px; padding: 12px 24px; font-size: 18px; cursor: pointer; margin-top: 18px; width: 100%; }
        .file-input-container { width: 100%; margin: 12px 0; }
        .file-input-label { display: block; padding: 12px; border: 2px dashed #002775; border-radius: 5px; text-align: center; cursor: pointer; color: #002775; font-weight: bold; transition: background-color 0.3s; font-size: 16px; min-height: 80px; background-size: cover; background-position: center; transition: border-style 0.3s, background-image 0.3s; }
        .file-input-label:hover { background-color: #f0f0f0; }
        .file-input { display: none; }
        .loading-message { display: none; color: #002775; margin: 12px 0; font-style: italic; font-size: 16px; }
        @media (min-width: 1024px) { body { max-width: 900px; } .container { padding: 30px; } #results { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; } .abacus-item { margin: 10px 0; } footer { max-width: 900px; } }
        @media (max-width: 480px) { body { max-width: 100%; } .container { padding: 15px; } #timer { font-size: 60px; } button { width: 200px; font-size: 16px; } footer { max-width: 100%; } }
    </style>
</head>
<body>
    <header>
        <img src="logo aplicativo.png" alt="" />
        <h1>Cont√Åbaco</h1>
    </header>

    <div class="container" id="mainScreen">
        <div id="timer">00:00</div>
        <select id="funcionario1">
            <option selected disabled>Selecione os funcion√°rios respons√°veis</option>
            <option>Alex Caetano</option>
            <option>Bruno Pereira</option>
            <option>Carlos Santi</option>
            <option>Danieli Francine</option>
            <option>Domingos Alexandre</option>
            <option>Flavio Martins</option>
            <option>Hobert Valdir</option>
            <option>Lisete Mathias</option>
            <option>Marcelo Grilo</option>
            <option>Marcelo Modolo</option>
            <option>Maria Antonia</option>
            <option>Myrna Yoshie</option>
            <option>Nisflei Carvalho</option>
            <option>Paola Maluceli</option>
            <option>Ra√≠ssa Marconato</option>
            <option>Ricardo Ivonei</option>
            <option>Viviane Virg√≠nia</option>
        </select>
        <select id="funcionario2">
            <option selected disabled>Selecione os funcion√°rios respons√°veis</option>
            <option>Alex Caetano</option>
            <option>Bruno Pereira</option>
            <option>Carlos Santi</option>
            <option>Danieli Francine</option>
            <option>Domingos Alexandre</option>
            <option>Flavio Martins</option>
            <option>Hobert Valdir</option>
            <option>Lisete Mathias</option>
            <option>Marcelo Grilo</option>
            <option>Marcelo Modolo</option>
            <option>Maria Antonia</option>
            <option>Myrna Yoshie</option>
            <option>Nisflei Carvalho</option>
            <option>Paola Maluceli</option>
            <option>Ra√≠ssa Marconato</option>
            <option>Ricardo Ivonei</option>
            <option>Viviane Virg√≠nia</option>
        </select>
        <div id="pauseBtnContainer" style="display: none;">
            <button class="pause-btn" id="pauseBtn">Pausar Turno</button>
        </div>
        <button id="startStopBtn">Iniciar Turno</button>
    </div>

    <div class="container scan-screen" id="scanScreen">
        <h2>
            ESCANEIE O √ÅBACO 
            <i class="fa-solid fa-pencil" id="editScanIcon" title="Editar manualmente"></i>
        </h2>
        <p class="demo-note">* Fa√ßa o upload de uma imagem do √°baco para an√°lise (simulada) ou clique no l√°pis para inserir os dados manualmente.</p>
        <div class="abacus-container">
            <div class="file-input-container">
                <label for="imageInput" class="file-input-label">üì∑ Clique para selecionar uma imagem do √°baco</label>
                <input type="file" id="imageInput" class="file-input" accept="image/*" />
                <div id="fileName" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
            </div>
            <button class="generate-btn" id="analyzeBtn">Analisar Imagem</button>
            <div id="loadingMessage" class="loading-message">Analisando imagem... Aguarde.</div>
        </div>
        <div id="results">
            <div class="abacus-item"><span class="abacus-title">Aerosaculite</span><span class="abacus-value" id="aerosaculite">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Celulite</span><span class="abacus-value" id="celulite">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Contus√£o</span><span class="abacus-value" id="contusao">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Hematomas</span><span class="abacus-value" id="hematomas">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Hepatite</span><span class="abacus-value" id="hepatite">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Micoplasmose</span><span class="abacus-value" id="micoplasmose">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Pericardite</span><span class="abacus-value" id="pericardite">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Peritonite</span><span class="abacus-value" id="peritonite">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Salmonelose</span><span class="abacus-value" id="salmonelose">0</span></div>
            <div class="abacus-item"><span class="abacus-title">Tuberculose</span><span class="abacus-value" id="tuberculose">0</span></div>
        </div>
        <button class="report-btn" id="reportBtn">Gerar Relat√≥rio</button>
    </div>

    <div class="container report-screen" id="reportScreen">
        <h2>Relat√≥rios</h2>
        <div id="reportsList"><p class="no-reports">Nenhum relat√≥rio gerado ainda</p></div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <p>Deseja realmente finalizar o turno?</p>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="confirmEnd">Sim</button>
                <button class="modal-btn cancel-btn" id="cancelEnd">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="modal" id="editScanModal">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto; width: 90%; max-width: 400px;">
            <h3 class="summary-title">Editar Contagem Manual</h3>
            <div id="editScanForm">
                <div class="edit-scan-item"><label for="edit_aerosaculite">Aerosaculite</label><input type="number" id="edit_aerosaculite" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_celulite">Celulite</label><input type="number" id="edit_celulite" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_contusao">Contus√£o</label><input type="number" id="edit_contusao" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_hematomas">Hematomas</label><input type="number" id="edit_hematomas" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_hepatite">Hepatite</label><input type="number" id="edit_hepatite" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_micoplasmose">Micoplasmose</label><input type="number" id="edit_micoplasmose" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_pericardite">Pericardite</label><input type="number" id="edit_pericardite" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_peritonite">Peritonite</label><input type="number" id="edit_peritonite" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_salmonelose">Salmonelose</label><input type="number" id="edit_salmonelose" class="edit-scan-input" min="0" value="0"></div>
                <div class="edit-scan-item"><label for="edit_tuberculose">Tuberculose</label><input type="number" id="edit_tuberculose" class="edit-scan-input" min="0" value="0"></div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" id="saveEditScan">Salvar</button>
                <button class="modal-btn cancel-btn" id="cancelEditScan">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="scan-required-modal" id="scanRequiredModal">
        <div class="scan-required-content">
            <div class="scan-required-text">Antes de finalizar, voc√™ precisa escanear o √°baco para registrar os dados da produ√ß√£o.</div>
            <button class="understand-btn" id="understandBtn">Entendi</button>
        </div>
    </div>

    <div class="summary-modal" id="summaryModal">
        <div class="summary-content">
            <h3 class="summary-title">Resumo do Turno</h3>
            <div class="summary-item"><span class="summary-label">Dura√ß√£o:</span><span class="summary-value" id="summaryDuration">00:00</span></div>
            <div class="summary-item"><span class="summary-label">Funcion√°rio 1:</span><span class="summary-value" id="summaryFunc1">N√£o selecionado</span></div>
            <div class="summary-item"><span class="summary-label">Funcion√°rio 2:</span><span class="summary-value" id="summaryFunc2">N√£o selecionado</span></div>
            <button class="summary-btn" id="closeSummary">Fechar</button>
        </div>
    </div>

    <div class="report-detail-modal" id="reportDetailModal">
        <div class="report-detail-content">
            <h3 class="report-detail-title" id="detailReportTitle">Relat√≥rio 1</h3>
            <div class="report-detail-info">
                <div class="report-detail-item"><span>Data:</span><span id="detailReportDate"></span></div>
                <div class="report-detail-item"><span>Dura√ß√£o:</span><span id="detailReportDuration"></span></div>
                <div class="report-detail-item"><span>Funcion√°rio 1:</span><span id="detailReportFunc1"></span></div>
                <div class="report-detail-item"><span>Funcion√°rio 2:</span><span id="detailReportFunc2"></span></div>
            </div>
            <div id="detailReportItems"></div>
            <div class="report-detail-total" id="detailReportTotal"></div>
            <div class="chart-container"><canvas id="reportChart"></canvas></div>
            <button class="close-report-btn" id="closeReportBtn">Fechar</button>
        </div>
    </div>

    <footer>
        <div class="icon-container" id="scanIcon" data-icon-default="333certo.png" data-icon-active="333certo.png">
            <img src="333certo.png" alt="Scanner" />
            <div class="circle"></div>
        </div>
        <div class="icon-container active" id="homeIcon" data-icon-default="111certo.png" data-icon-active="111.1certo.png">
            <img src="111certo.png" alt="Home" />
            <div class="circle"></div>
        </div>
        <div class="icon-container" id="reportIcon" data-icon-default="222certo.png" data-icon-active="222.1certo.png">
            <img src="222certo.png" alt="Relat√≥rio" />
            <div class="circle"></div>
        </div>
    </footer>

    <script>
        let timer; let seconds = 0; let isPaused = false; let hasScanned = false; let isShiftActive = false; let reportCounter = 1; let reports = []; let reportChart = null;
        const timerDisplay = document.getElementById("timer");
        const button = document.getElementById("startStopBtn");
        const pauseBtn = document.getElementById("pauseBtn");
        const pauseBtnContainer = document.getElementById("pauseBtnContainer");
        const mainScreen = document.getElementById("mainScreen");
        const scanScreen = document.getElementById("scanScreen");
        const reportScreen = document.getElementById("reportScreen");
        const scanIcon = document.getElementById("scanIcon");
        const homeIcon = document.getElementById("homeIcon");
        const reportIcon = document.getElementById("reportIcon");
        const imageInput = document.getElementById("imageInput");
        const analyzeBtn = document.getElementById("analyzeBtn");
        const loadingMessage = document.getElementById("loadingMessage");
        const fileName = document.getElementById("fileName");
        const fileInputLabel = document.querySelector(".file-input-label");
        const reportBtn = document.getElementById("reportBtn");
        const confirmModal = document.getElementById("confirmModal");
        const confirmEnd = document.getElementById("confirmEnd");
        const cancelEnd = document.getElementById("cancelEnd");
        const scanRequiredModal = document.getElementById("scanRequiredModal");
        const understandBtn = document.getElementById("understandBtn");
        const summaryModal = document.getElementById("summaryModal");
        const closeSummary = document.getElementById("closeSummary");
        const summaryDuration = document.getElementById("summaryDuration");
        const summaryFunc1 = document.getElementById("summaryFunc1");
        const summaryFunc2 = document.getElementById("summaryFunc2");
        const funcionario1Select = document.getElementById("funcionario1");
        const funcionario2Select = document.getElementById("funcionario2");
        const reportsList = document.getElementById("reportsList");
        const reportDetailModal = document.getElementById("reportDetailModal");
        const detailReportTitle = document.getElementById("detailReportTitle");
        const detailReportDate = document.getElementById("detailReportDate");
        const detailReportDuration = document.getElementById("detailReportDuration");
        const detailReportFunc1 = document.getElementById("detailReportFunc1");
        const detailReportFunc2 = document.getElementById("detailReportFunc2");
        const detailReportItems = document.getElementById("detailReportItems");
        const detailReportTotal = document.getElementById("detailReportTotal");
        const reportChartCanvas = document.getElementById("reportChart");
        const closeReportBtn = document.getElementById("closeReportBtn");
        const editScanIcon = document.getElementById("editScanIcon");
        const editScanModal = document.getElementById("editScanModal");
        const saveEditScan = document.getElementById("saveEditScan");
        const cancelEditScan = document.getElementById("cancelEditScan");

        const conditions = ["aerosaculite", "celulite", "contusao", "hematomas", "hepatite", "micoplasmose", "pericardite", "peritonite", "salmonelose", "tuberculose"];        
        const initializeValues = () => { conditions.forEach(condition => { document.getElementById(condition).textContent = "0"; }); };
        window.onload = initializeValues;

        function updateTimerDisplay() { const mins = String(Math.floor(seconds / 60)).padStart(2, "0"); const secs = String(seconds % 60).padStart(2, "0"); timerDisplay.textContent = `${mins}:${secs}`; }
        function startTimer() { isShiftActive = true; timer = setInterval(() => { if (!isPaused) { seconds++; updateTimerDisplay(); } }, 1000); }
        function stopTimer() { clearInterval(timer); }
        function resetTimer() { stopTimer(); seconds = 0; updateTimerDisplay(); isShiftActive = false; button.textContent = "Iniciar Turno"; button.classList.remove("active"); pauseBtnContainer.style.display = "none"; isPaused = false; pauseBtn.textContent = "Pausar Turno"; pauseBtn.style.backgroundColor = "#FFA500"; }
        function resetFuncionarios() { funcionario1Select.selectedIndex = 0; funcionario2Select.selectedIndex = 0; }
        function showSummary() { summaryDuration.textContent = timerDisplay.textContent; const func1 = funcionario1Select.value || "N√£o selecionado"; const func2 = funcionario2Select.value || "N√£o selecionado"; summaryFunc1.textContent = func1 === "Selecione os funcion√°rios respons√°veis" ? "N√£o selecionado" : func1; summaryFunc2.textContent = func2 === "Selecione os funcion√°rios respons√°veis" ? "N√£o selecionado" : func2; summaryModal.style.display = "flex"; }
        function createReport() { const reportData = { id: reportCounter, date: new Date().toLocaleString(), duration: timerDisplay.textContent, funcionario1: funcionario1Select.value, funcionario2: funcionario2Select.value, values: {}, total: 0 }; conditions.forEach(condition => { const value = parseInt(document.getElementById(condition).textContent); reportData.values[condition] = value; reportData.total += value; }); reports.unshift(reportData); reportCounter++; updateReportsList(); resetTimer(); resetFuncionarios(); initializeValues(); }
        function updateReportsList() { if (reports.length === 0) { reportsList.innerHTML = '<p class="no-reports">Nenhum relat√≥rio gerado ainda</p>'; return; } reportsList.innerHTML = ''; reports.forEach(report => { const reportItem = document.createElement('div'); reportItem.className = 'report-item'; reportItem.dataset.reportId = report.id; const reportHeader = document.createElement('div'); reportHeader.className = 'report-header'; reportHeader.innerHTML = `<span>Relat√≥rio ${report.id}</span>`; const reportDate = document.createElement('div'); reportDate.className = 'report-date'; reportDate.textContent = report.date; const reportFuncionarios = document.createElement('div'); reportFuncionarios.className = 'report-funcionarios'; reportFuncionarios.textContent = `${report.funcionario1} e ${report.funcionario2}`; reportItem.appendChild(reportHeader); reportItem.appendChild(reportDate); reportItem.appendChild(reportFuncionarios); reportItem.addEventListener('click', () => showReportDetails(report.id)); reportsList.appendChild(reportItem); }); }
        function showReportDetails(reportId) { const report = reports.find(r => r.id === reportId); if (!report) return; detailReportTitle.textContent = `Relat√≥rio ${report.id}`; detailReportDate.textContent = report.date; detailReportDuration.textContent = report.duration; detailReportFunc1.textContent = report.funcionario1; detailReportFunc2.textContent = report.funcionario2; detailReportItems.innerHTML = ''; for (const [key, value] of Object.entries(report.values)) { const item = document.createElement('div'); item.className = 'report-detail-item'; item.innerHTML = `<span>${key.charAt(0).toUpperCase() + key.slice(1)}:</span><span>${value}</span>`; detailReportItems.appendChild(item); } detailReportTotal.innerHTML = `<span>Total:</span><span>${report.total}</span>`; updateChart(report); reportDetailModal.style.display = "flex"; }
        function updateChart(report) { if (reportChart) { reportChart.destroy(); } const labels = conditions.map(cond => cond.charAt(0).toUpperCase() + cond.slice(1)); const data = conditions.map(cond => report.values[cond]); const backgroundColors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#8AC24A', '#607D8B', '#E91E63', '#9C27B0']; const ctx = reportChartCanvas.getContext('2d'); reportChart = new Chart(ctx, { type: 'pie', data: { labels: labels, datasets: [{ data: data, backgroundColor: backgroundColors, borderWidth: 1 }] }, options: { responsive: true, plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: function (context) { const label = context.label || ''; const value = context.raw || 0; const total = context.dataset.data.reduce((a, b) => a + b, 0); const percentage = total > 0 ? Math.round((value / total) * 100) : 0; return `${label}: ${value} (${percentage}%)`; } } } } } }); }
        function finalizeShift() { stopTimer(); showSummary(); button.textContent = "Iniciar Turno"; button.classList.remove("active"); pauseBtnContainer.style.display = "none"; isPaused = false; pauseBtn.textContent = "Pausar Turno"; pauseBtn.style.backgroundColor = "#FFA500"; confirmModal.style.display = "none"; hasScanned = false; resetFuncionarios(); }

        // *** VERS√ÉO FAKE SEM IA ***
        async function analyzeImageWithAI(imageFile) {
            try {
                loadingMessage.style.display = "block";
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = "Analisando...";
                // simula ~10 segundos de processamento
                await new Promise(resolve => setTimeout(resolve, 10000));
                // gera contagens aleat√≥rias (0‚Äì25) para cada condi√ß√£o
                const fakeCounts = {};
                conditions.forEach(cond => { fakeCounts[cond] = Math.floor(Math.random() * 11); });
                updateValuesFromCounts(fakeCounts);
                hasScanned = true;
                alert("An√°lise conclu√≠da (simulada).");
            } catch (error) {
                alert("Ocorreu um erro na simula√ß√£o.");
                console.error("Erro na simula√ß√£o:", error);
            } finally {
                loadingMessage.style.display = "none";
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = "Analisar Imagem";
            }
        }

        function updateValuesFromCounts(counts) { conditions.forEach(condition => { const value = counts[condition] || 0; document.getElementById(condition).textContent = value; }); }

        button.addEventListener("click", () => { if (button.classList.contains("active")) { confirmModal.style.display = "flex"; } else { if (funcionario1Select.selectedIndex === 0 || funcionario2Select.selectedIndex === 0) { alert("Por favor, selecione os funcion√°rios respons√°veis antes de iniciar o turno."); return; } startTimer(); button.textContent = "Finalizar Turno"; button.classList.add("active"); pauseBtnContainer.style.display = "block"; } });
        pauseBtn.addEventListener("click", () => { isPaused = !isPaused; pauseBtn.textContent = isPaused ? "Continuar Turno" : "Pausar Turno"; pauseBtn.style.backgroundColor = isPaused ? "#4CAF50" : "#FFA500"; });
        confirmEnd.addEventListener("click", () => { if (!hasScanned) { confirmModal.style.display = "none"; scanRequiredModal.style.display = "flex"; } else { finalizeShift(); } });
        cancelEnd.addEventListener("click", () => { confirmModal.style.display = "none"; });
        closeSummary.addEventListener("click", () => { summaryModal.style.display = "none"; resetTimer(); });
        closeReportBtn.addEventListener("click", () => { reportDetailModal.style.display = "none"; });
        understandBtn.addEventListener("click", function () { scanRequiredModal.style.display = "none"; mainScreen.style.display = "none"; scanScreen.style.display = "flex"; updateActiveIcon(scanIcon); });
        analyzeBtn.addEventListener("click", function () { const file = imageInput.files[0]; if (!file) { alert("Por favor, selecione uma imagem do √°baco."); return; } if (!file.type.match('image.*')) { alert("Por favor, selecione um arquivo de imagem."); return; } analyzeImageWithAI(file); });
        imageInput.addEventListener("change", function () { if (this.files && this.files[0]) { const file = this.files[0]; fileName.textContent = "Arquivo selecionado: " + file.name; const reader = new FileReader(); reader.onload = function(e) { fileInputLabel.style.backgroundImage = `url(${e.target.result})`; fileInputLabel.style.backgroundSize = "cover"; fileInputLabel.style.backgroundPosition = "center"; fileInputLabel.style.borderStyle = "solid"; fileInputLabel.textContent = ""; }; reader.readAsDataURL(file); } else { fileName.textContent = ""; fileInputLabel.style.backgroundImage = "none"; fileInputLabel.style.borderStyle = "dashed"; fileInputLabel.textContent = "üì∑ Clique para selecionar uma imagem do √°baco"; } });
        reportBtn.addEventListener("click", function () { if (!hasScanned) { alert("Por favor, analise uma imagem ou insira os dados manualmente primeiro."); return; } createReport(); scanScreen.style.display = "none"; reportScreen.style.display = "flex"; updateActiveIcon(reportIcon); });
        scanIcon.addEventListener("click", () => { if (isShiftActive) { mainScreen.style.display = "none"; scanScreen.style.display = "flex"; reportScreen.style.display = "none"; updateActiveIcon(scanIcon); } });
        homeIcon.addEventListener("click", () => { mainScreen.style.display = "flex"; scanScreen.style.display = "none"; reportScreen.style.display = "none"; updateActiveIcon(homeIcon); });
        reportIcon.addEventListener("click", () => { mainScreen.style.display = "none"; scanScreen.style.display = "none"; reportScreen.style.display = "flex"; updateActiveIcon(reportIcon); updateReportsList(); });
        editScanIcon.addEventListener("click", () => { conditions.forEach(condition => { const currentValue = document.getElementById(condition).textContent; const inputField = document.getElementById(`edit_${condition}`); inputField.value = currentValue; }); editScanModal.style.display = "flex"; });
        cancelEditScan.addEventListener("click", () => { editScanModal.style.display = "none"; });
        saveEditScan.addEventListener("click", () => { conditions.forEach(condition => { const inputField = document.getElementById(`edit_${condition}`); let newValue = parseInt(inputField.value); if (isNaN(newValue) || newValue < 0) { newValue = 0; } const displaySpan = document.getElementById(condition); displaySpan.textContent = newValue; }); hasScanned = true; editScanModal.style.display = "none"; });
        function updateActiveIcon(activeIcon) { [scanIcon, homeIcon, reportIcon].forEach(icon => { icon.classList.remove("active"); const img = icon.querySelector("img"); img.src = icon.dataset.iconDefault; }); activeIcon.classList.add("active"); const imgAtiva = activeIcon.querySelector("img"); imgAtiva.src = activeIcon.dataset.iconActive; }
        document.querySelectorAll(".icon-container").forEach(i => { const img = i.querySelector("img"); img.src = i.classList.contains("active") ? i.dataset.iconActive : i.dataset.iconDefault; });
    </script>
</body>
</html>